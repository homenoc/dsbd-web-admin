<div class="main">
  <ng-container *ngIf="loading">
    <h2>ID: {{id}}</h2>
    <h1>読み込み中...</h1>
  </ng-container>
  <ng-container *ngIf="!loading">
    <h1>
      ServiceCode:
      {{serviceCode}}-{{connection.connection_template.type}}{{('000' + connection.connection_number).slice(-3)}}
    </h1>
    <br>
    <mat-tab-group>
      <mat-tab label="情報">
        <br>
        <table>
          <tr>
            <th colspan="4">NOC</th>
          </tr>
          <ng-container *ngIf="connection.noc_id !== null">
            <tr>
              <th>ID</th>
              <td colspan="1">{{connection.noc_id}}</td>
              <th>LINK</th>
              <td colspan="1">
                <button mat-raised-button (click)="linkNOC(connection.noc_id)">リンク</button>
              </td>
            </tr>
            <tr>
              <th>Name</th>
              <td colspan="1">{{connection.noc.name}}</td>
              <th>Enable</th>
              <td colspan="1">{{connection.noc.enable}}
            </tr>
          </ng-container>
        </table>
        <br>
        <table>
          <tr>
            <th colspan="4">BGP Router</th>
          </tr>
          <ng-container *ngIf="connection.bgp_router_id !== 0">
            <tr>
              <th>ID</th>
              <td colspan="1">{{connection.bgp_router_id}}</td>
              <th>LINK</th>
              <td colspan="1">
                <button mat-raised-button (click)="linkRouter(connection.bgp_router_id)">リンク</button>
              </td>
            </tr>
            <tr>
              <th>HostName</th>
              <td colspan="1">{{connection.bgp_router.hostname}}</td>
              <th>Enable</th>
              <td colspan="1">{{connection.bgp_router.enable}}
            </tr>
          </ng-container>
        </table>
        <br>
        <table>
          <tr>
            <th colspan="4">Tunnel Endpoint Router</th>
          </tr>
          <ng-container *ngIf="connection.tunnel_endpoint_router_ip_id !== 0">
            <tr>
              <th>ID</th>
              <td colspan="1">{{connection.tunnel_endpoint_router_ip_id}}</td>
              <th>LINK</th>
              <td colspan="1">
                <button mat-raised-button (click)="linkGateway(connection.tunnel_endpoint_router_ip_id)">リンク</button>
              </td>
            </tr>
            <tr>
              <th>IP</th>
              <td colspan="1">{{connection.tunnel_endpoint_router_ip.ip}}</td>
              <th>Enable</th>
              <td colspan="1">{{connection.tunnel_endpoint_router_ip.enable}}
            </tr>
          </ng-container>
        </table>
        <br>
        <table>
          <tr>
            <th colspan="2">Connection Information</th>
          </tr>
          <tr>
            <th>User Create Date</th>
            <td>{{connection.CreatedAt}}</td>
          </tr>
          <tr>
            <th>User Update Date</th>
            <td>{{connection.UpdatedAt}}</td>
          </tr>
          <tr>
            <th>開通</th>
            <td>{{connection.open}}</td>
          </tr>
          <tr>
            <th>Lock</th>
            <td>{{connection.lock}}</td>
          </tr>
          <tr>
            <th>NTT</th>
            <td>{{connection.ntt_template.name}}</td>
          </tr>
          <tr>
            <th>Term IP</th>
            <td>{{connection.term_ip}}</td>
          </tr>
          <tr>
            <th>Link v4 Our</th>
            <td>{{connection.link_v4_our}}</td>
          </tr>
          <tr>
            <th>Link v4 Your</th>
            <td>{{connection.link_v4_your}}</td>
          </tr>
          <tr>
            <th>Link v6 Our</th>
            <td>{{connection.link_v6_our}}</td>
          </tr>
          <tr>
            <th>Link v6 Your</th>
            <td>{{connection.link_v6_your}}</td>
          </tr>
          <tr>
            <th>Monitor</th>
            <td>{{connection.monitor}}</td>
          </tr>
        </table>
      </mat-tab>
      <mat-tab label="設定">
        <ng-template matTabContent>
          <br>
          <div class="main">
            <p>Updateしたいデータを記入することで、その部分のみが更新されます。</p>
            <form [formGroup]="connectionInput">
              <mat-form-field appearance="fill">
                <mat-label>Connection Type</mat-label>
                <mat-select formControlName="connection_template_id" required>
                  <ng-container *ngFor="let c of this.templates.connections">
                    <mat-option [value]="c.ID">{{c.ID}}({{c.name}})</mat-option>
                  </ng-container>
                </mat-select>
              </mat-form-field>
              &nbsp;
              <mat-form-field appearance="fill">
                <mat-label>Connection Number</mat-label>
                <input matInput type="number" formControlName="connection_number">
              </mat-form-field>
              <br>
              <mat-form-field appearance="fill">
                <mat-label>NOC</mat-label>
                <mat-select formControlName="noc_id" required>
                  <ng-container *ngFor="let noc of this.templates.nocs">
                    <mat-option [value]="noc.ID">{{noc.ID}}({{noc.name}})</mat-option>
                  </ng-container>
                </mat-select>
              </mat-form-field>
              &nbsp;
              <mat-form-field appearance="fill">
                <mat-label>Service ID</mat-label>
                <input matInput type="number" formControlName="service_id">
              </mat-form-field>
              &nbsp;
              <mat-form-field appearance="fill">
                <mat-label>RouterID (BGP)</mat-label>
                <mat-select formControlName="bgp_router_id" required>
                  <ng-container *ngFor="let router of this.templates.bgp_router">
                    <mat-option [value]="router.ID">{{router.hostname}}</mat-option>
                  </ng-container>
                  <mat-option [value]="0">なし<b>(初期値0)</b></mat-option>
                </mat-select>
              </mat-form-field>
              &nbsp;
              <mat-form-field appearance="fill">
                <mat-label>TunnelEndPointRouter IP (ctepxxなど)</mat-label>
                <mat-select formControlName="tunnel_endpoint_router_ip_id" required>
                  <ng-container *ngFor="let gatewayIP of this.templateTunnelEndPointRouterIP">
                    <mat-option [value]="gatewayIP.ID">{{gatewayIP.hostname}}<b>({{gatewayIP.ip}})</b></mat-option>
                  </ng-container>
                  <mat-option [value]="0">なし<b>(初期値0)</b></mat-option>
                </mat-select>
              </mat-form-field>
              <br>
              <mat-form-field appearance="fill">
                <mat-label>NTT</mat-label>
                <mat-select formControlName="ntt_template_id" required>
                  <ng-container *ngFor="let ntt of this.templates.ntts">
                    <mat-option [value]="ntt.ID">{{ntt.name}}</mat-option>
                  </ng-container>
                </mat-select>
              </mat-form-field>
              <br>
              <mat-form-field appearance="fill">
                <mat-label>Term IP</mat-label>
                <input matInput type="text" formControlName="term_ip">
              </mat-form-field>
              <br>
              <mat-form-field appearance="fill">
                <mat-label>Link V4 Our</mat-label>
                <input matInput type="text" formControlName="link_v4_our">
              </mat-form-field>
              &nbsp;
              <mat-form-field appearance="fill">
                <mat-label>Link V4 Your</mat-label>
                <input matInput type="text" formControlName="link_v4_your">
              </mat-form-field>
              <br>
              <mat-form-field appearance="fill">
                <mat-label>Link V6 Our</mat-label>
                <input matInput type="text" formControlName="link_v6_our">
              </mat-form-field>
              &nbsp;
              <mat-form-field appearance="fill">
                <mat-label>Link V6 Your</mat-label>
                <input matInput type="text" formControlName="link_v6_your">
              </mat-form-field>
              <br>
              <mat-checkbox formControlName="open">開通済み</mat-checkbox>
              &nbsp;
              <mat-checkbox formControlName="monitor">Monitor</mat-checkbox>
              &nbsp;
              <mat-checkbox formControlName="lock">Lock</mat-checkbox>
              &nbsp;
            </form>
            <br>
            <button mat-stroked-button color="primary" (click)="update()">Update</button>
            <br>
          </div>
        </ng-template>
      </mat-tab>
    </mat-tab-group>
  </ng-container>
  <br>
</div>
