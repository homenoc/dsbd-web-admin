<div class="main">
  <h2>GID: {{org}} ID: {{id}} Status: <b>{{statusInfo}}</b></h2>
  <ng-container *ngIf="loading">
    <h1>読み込み中...</h1>
  </ng-container>
  <ng-container *ngIf="!loading">
    <mat-tab-group>
      <mat-tab label="情報">
        <br>
        <ng-container *ngIf="!group.pass">
          <button mat-raised-button color="primary" (click)="updatePass(true)">審査承認(グループ)</button>
        </ng-container>
        <ng-container *ngIf="group.pass">
        <ng-container *ngIf="group.status === 0">
          <button mat-raised-button color="primary" (click)="updateStatus(1)">サービス情報の追加</button>
        </ng-container>
        <ng-container *ngIf="group.status === 1">
          <button mat-raised-button color="primary" (click)="updateStatus(2)">審査承認(サービス)</button>
        </ng-container>
        <ng-container *ngIf="group.status === 2">
          <button mat-raised-button color="primary" (click)="updateStatus(3)">接続情報記入</button>
        </ng-container>
        <ng-container *ngIf="group.status === 3">
          <button mat-raised-button color="primary" (click)="updateStatus(4)">開通作業</button>
        </ng-container>
        <ng-container *ngIf="group.status === 4">
          <button mat-raised-button color="primary" (click)="updateStatus(0)">開通</button>
        </ng-container>
        <ng-container *ngIf="group.lock">
          <button mat-raised-button color="primary" (click)="requestLock(false)">ユーザ側からの変更を許可</button>
        </ng-container>
        <ng-container *ngIf="!group.lock">
          <button mat-raised-button color="warn" (click)="requestLock(true)">ユーザ側からの変更を拒否</button>
        </ng-container>
        </ng-container>
        <button mat-raised-button [matMenuTriggerFor]="abolished" color="warn">廃止</button>
        <mat-menu #abolished="matMenu">
          <button mat-menu-item (click)="updateExpiredStatus(0)">廃止の解除</button>
          <button mat-menu-item (click)="updateExpiredStatus(1)">ユーザより廃止</button>
          <button mat-menu-item (click)="updateExpiredStatus(2)">運営委員より廃止</button>
          <button mat-menu-item (click)="updateExpiredStatus(3)">審査落ち</button>
        </mat-menu>
        <br>
        <br>
        <br>
        <table>
          <tr>
            <th colspan="2">Group Information</th>
          </tr>
          <tr>
            <th>User Create Date</th>
            <td>{{group.CreatedAt}}</td>
          </tr>
          <tr>
            <th>User Update Date</th>
            <td>{{group.UpdatedAt}}</td>
          </tr>
          <tr>
            <th>Org</th>
            <td>{{group.org}}</td>
          </tr>
          <tr>
            <th>Agreement</th>
            <td>{{group.agree}}</td>
          </tr>
          <tr>
            <th>Comment</th>
            <td>{{group.comment}}</td>
          </tr>
          <tr>
            <th>学生</th>
            <td>{{group.student}}</td>
          </tr>
          <tr>
            <th>卒業予定</th>
            <td>{{group.student_expired}}</td>
          </tr>
          <tr>
            <th>Status</th>
            <td>{{group.status}}</td>
          </tr>
          <tr>
            <th>ExpiredStatus</th>
            <td>{{group.expired_status}}</td>
          </tr>
          <tr>
            <th>Pass</th>
            <td>{{group.pass}}</td>
          </tr>
          <tr>
            <th>Lock</th>
            <td>{{group.lock}}</td>
          </tr>
        </table>
        <br>
        <mat-accordion>
          <mat-expansion-panel class="card">
            <mat-expansion-panel-header>
              <mat-panel-title>Question</mat-panel-title>
            </mat-expansion-panel-header>
            <p>{{group.question}}</p>
          </mat-expansion-panel>
        </mat-accordion>
        <br>
        <mat-accordion>
          <mat-expansion-panel class="card">
            <mat-expansion-panel-header>
              <mat-panel-title>グループ詳細情報</mat-panel-title>
            </mat-expansion-panel-header>
            <table>
              <tr>
                <th colspan="2">Group Information</th>
              </tr>
              <tr>
                <th>Org</th>
                <td>{{group.org}}</td>
              </tr>
              <tr>
                <th>Org(English)</th>
                <td>{{group.org_en}}</td>
              </tr>
              <tr>
                <th>PostCode</th>
                <td>{{group.postcode}}</td>
              </tr>
              <tr>
                <th>Address</th>
                <td>{{group.address}}</td>
              </tr>
              <tr>
                <th>Address(English)</th>
                <td>{{group.address_en}}</td>
              </tr>
              <tr>
                <th>Tel</th>
                <td>{{group.tel}}</td>
              </tr>
              <tr>
                <th>Country</th>
                <td>{{group.country}}</td>
              </tr>
            </table>
          </mat-expansion-panel>
        </mat-accordion>
        <br>
        <mat-accordion>
          <mat-expansion-panel class="card">
            <mat-expansion-panel-header>
              <mat-panel-title>Contract</mat-panel-title>
            </mat-expansion-panel-header>
            <p>{{group.contract}}</p>
          </mat-expansion-panel>
        </mat-accordion>
        <br>
      </mat-tab>
      <mat-tab label="設定">
        <ng-template matTabContent>
          <br>
          <div class="main">
            <p>Updateしたいデータを記入することで、その部分のみが更新されます。</p>
            <form [formGroup]="groupInput">
              <mat-form-field appearance="fill">
                <mat-label>Org</mat-label>
                <input matInput type="text" formControlName="org">
              </mat-form-field>
              <br>
              <mat-form-field appearance="fill">
                <mat-label>Status</mat-label>
                <input matInput type="number" formControlName="status">
              </mat-form-field>
              &nbsp;
              <h3>Lock</h3>
              <mat-checkbox formControlName="lock">Lock</mat-checkbox>
            </form>
            <br>
            <button mat-stroked-button color="primary" (click)="update()">Update</button>
            <br>
          </div>
        </ng-template>
      </mat-tab>
      <mat-tab label="ユーザ情報">
        <h2>User情報</h2>
        <ng-container *ngFor="let d of group.users">
          <mat-card class="card">
            <mat-card-header>
              <mat-card-title>{{d.name}}</mat-card-title>
              <mat-card-subtitle>ID:{{d.ID}}</mat-card-subtitle>
              <mat-card-subtitle>{{d.email}}</mat-card-subtitle>
            </mat-card-header>
            <mat-card-content>
              <mat-card-subtitle>
                <mat-chip-list>
                  <ng-container *ngIf="!d.mail_verify">
                    <mat-chip color="warn" selected>メール未認証</mat-chip>
                  </ng-container>
                  <ng-container *ngIf="d.status === 0">
                    <mat-chip color="warn" selected>情報未入力</mat-chip>
                  </ng-container>
                </mat-chip-list>
              </mat-card-subtitle>
              <p></p>
            </mat-card-content>
            <mat-card-actions>
              <button mat-button (click)="userPage(d.ID)">User Page</button>
            </mat-card-actions>
          </mat-card>
        </ng-container>
        <br>
      </mat-tab>
      <mat-tab label="サービス情報">
        <h2>サービス一覧</h2>
        <button mat-button color="primary" (click)="createNetworkInfo()">サービス情報の追加</button>
        <button mat-button color="primary" (click)="createConnectionInfo()">接続情報の追加</button>

        <br>
        <ng-container *ngFor="let d of group.services">
          <mat-card class="card">
            <mat-card-header>
              <mat-card-title>
                {{d.group_id}}-{{d.service_template.type}}{{('000' + d.service_number).slice(-3)}}
              </mat-card-title>
              <mat-card-subtitle>ID: <b>{{d.ID}}</b></mat-card-subtitle>
              <mat-card-subtitle>種別: <b>{{d.service_template.name}}</b></mat-card-subtitle>
            </mat-card-header>
            <mat-card-content>
              <mat-card-subtitle>
                <mat-chip-list>
                  <ng-container *ngIf="d.open">
                    <mat-chip color="primary" selected>開通</mat-chip>
                  </ng-container>
                  <ng-container *ngIf="!d.open">
                    <mat-chip color="warn" selected>未開通</mat-chip>
                  </ng-container>
                </mat-chip-list>
              </mat-card-subtitle>
            </mat-card-content>
            <mat-card-actions>
              <button mat-button (click)="servicePage(d.ID)">詳細</button>
              <p>（開通/未開通処理を行いたい場合は詳細ボタンよりできます。）</p>
            </mat-card-actions>
            <ng-container *ngFor="let connection of d.connections">
              <mat-accordion>
                <mat-expansion-panel>
                  <mat-expansion-panel-header>
                    <mat-panel-title>
                      <b>{{d.group_id}}-{{d.service_template.type}}{{('000' + d.service_number).slice(-3)}}-{{connection.connection_template.type}}{{('000' + connection.connection_number).slice(-3)}}
                        ({{connection.noc.name}})
                      </b>
                      <br>
                    </mat-panel-title>
                    <mat-card-subtitle>ID:{{connection.ID}}&nbsp;&nbsp;&nbsp;</mat-card-subtitle>
                    <mat-panel-description>
                      <mat-chip-list>
                        <ng-container *ngIf="connection.open">
                          <mat-chip color="primary" selected>開通</mat-chip>
                        </ng-container>
                        <ng-container *ngIf="!connection.open">
                          <mat-chip color="warn" selected>未開通</mat-chip>
                        </ng-container>
                      </mat-chip-list>
                    </mat-panel-description>
                  </mat-expansion-panel-header>
                  <br><br>
                  <table>
                    <tr>
                      <th colspan="2">内容</th>
                    </tr>
                    <tr>
                      <th>サービス種別</th>
                      <td>{{d.service_template.name}}</td>
                    </tr>
                    <tr>
                      <th>利用料金</th>
                      <td>{{d.fee}}</td>
                    </tr>
                    <tr>
                      <th>当団体からのIPアドレスの割当</th>
                      <td>{{d.service_template.need_jpnic}}</td>
                    </tr>
                  </table>
                  <br>
                  <table>
                    <tr>
                      <th colspan="3">接続情報</th>
                    </tr>
                    <tr>
                      <th>接続方式</th>
                      <td colspan="2">{{connection.connection_template.name}}</td>
                    </tr>
                    <tr>
                      <th>接続NOC</th>
                      <td colspan="2">{{connection.noc.name}}</td>
                    </tr>
                    <tr>
                      <th>トンネル終端アドレス（貴団体側）</th>
                      <td colspan="2">{{connection.term_ip}}</td>
                    </tr>
                    <tr>
                      <th>トンネル終端アドレス（当団体側）</th>
                      <td colspan="2">{{connection.tunnel_endpoint_router_ip.ip}}</td>
                    </tr>
                    <tr>
                      <th colspan="3">当団体との間の境界アドレス</th>
                    </tr>
                    <tr>
                      <th></th>
                      <th>IPv4アドレス</th>
                      <th>IPv6アドレス</th>
                    </tr>
                    <tr>
                      <th>当団体側</th>
                      <td>{{connection.link_v4_our}}</td>
                      <td>{{connection.link_v6_our}}</td>
                    </tr>
                    <tr>
                      <th>貴団体側</th>
                      <td>{{connection.link_v4_your}}</td>
                      <td>{{connection.link_v6_your}}</td>
                    </tr>
                  </table>
                </mat-expansion-panel>
              </mat-accordion>
              <br>
            </ng-container>
          </mat-card>
        </ng-container>
        <br>
      </mat-tab>
    </mat-tab-group>
  </ng-container>
  <br>
</div>
